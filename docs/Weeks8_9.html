<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Weeks 8 &amp; 9: Building a corpus from literature sources</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-532fce776c63c931076d5ce395638b42.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="site_libs/quarto-contrib/iconify-2.1.0/iconify-icon.min.js"></script>
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link href="site_libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="site_libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<script src="site_libs/d3-3.3.8/d3.min.js"></script>
<script src="site_libs/dagre-0.4.0/dagre-d3.min.js"></script>
<link href="site_libs/mermaid-0.3.0/dist/mermaid.css" rel="stylesheet">
<script src="site_libs/mermaid-0.3.0/dist/mermaid.slim.min.js"></script>
<link href="site_libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="site_libs/chromatography-0.1/chromatography.js"></script>
<script src="site_libs/DiagrammeR-binding-1.0.11/DiagrammeR.js"></script>


</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Welcome page</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./intro.html" aria-current="page"> 
<span class="menu-text">Get into the course</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="./instructor.html"> 
<span class="menu-text">Instructor</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <a class="flex-grow-1 no-decor" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
          <h1 class="quarto-secondary-nav-title">Weeks 8 &amp; 9: Building a corpus from literature sources</h1>
        </a>     
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 1: Introduction</span></a>
  </div>
</li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false">
 <span class="menu-text">Part 1: Principles of corpus studies</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Week2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 2: What is a corpus, and their role to understand language and literature</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Week3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 3: Types of corpora: Selecting or building a corpus?</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Part 2: Building a corpus from the internet with modern tools</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Week4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 4: Introduction to the modern tool R (1/2): Installation and first steps</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Week5_1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 5: Introduction to R (2/2): Basic functions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Week5_2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 5: Introduction to R (2/2): How to create reproducible data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Weeks6_7.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Weeks 6 &amp; 7: Building a corpus from media platforms</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Weeks8_9.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Weeks 8 &amp; 9: Building a corpus from literature sources</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Week 10: Midterm presentations</span></span>
  </li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false">
 <span class="menu-text">Part 3: Simple preprocessing and analyses of corpus data</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Weeks11.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 11: Data preprocessing - Tidying/Cleaning data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Week12.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 12: Data analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Week13.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 13: Data visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Weeks14.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 14: Presenting a corpus-based study</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Week 15: Group and individual meetings in the classroom</span></span>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Week 16: Final presentations</span></span>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#building-your-own-corpus-again-what-you-need-to-know" id="toc-building-your-own-corpus-again-what-you-need-to-know" class="nav-link active" data-scroll-target="#building-your-own-corpus-again-what-you-need-to-know"><span class="header-section-number">1</span> Building your own corpus again: What you need to know</a></li>
  <li><a href="#document-your-own-manual-steps" id="toc-document-your-own-manual-steps" class="nav-link" data-scroll-target="#document-your-own-manual-steps"><span class="header-section-number">2</span> Document your own manual steps</a>
  <ul class="collapse">
  <li><a href="#what-is-the-task" id="toc-what-is-the-task" class="nav-link" data-scroll-target="#what-is-the-task"><span class="header-section-number">2.1</span> What is the task</a></li>
  <li><a href="#documentation-of-the-manual-steps" id="toc-documentation-of-the-manual-steps" class="nav-link" data-scroll-target="#documentation-of-the-manual-steps"><span class="header-section-number">2.2</span> Documentation of the manual steps</a>
  <ul class="collapse">
  <li><a href="#accessing-the-individual-books" id="toc-accessing-the-individual-books" class="nav-link" data-scroll-target="#accessing-the-individual-books">Accessing the individual books</a></li>
  </ul></li>
  <li><a href="#more-about-the-structure-of-the-website" id="toc-more-about-the-structure-of-the-website" class="nav-link" data-scroll-target="#more-about-the-structure-of-the-website"><span class="header-section-number">2.3</span> More about the structure of the website</a>
  <ul class="collapse">
  <li><a href="#accessing-the-individual-chapters" id="toc-accessing-the-individual-chapters" class="nav-link" data-scroll-target="#accessing-the-individual-chapters">Accessing the individual chapters</a></li>
  <li><a href="#accessing-the-content-of-the-chapter" id="toc-accessing-the-content-of-the-chapter" class="nav-link" data-scroll-target="#accessing-the-content-of-the-chapter">Accessing the content of the chapter</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#scraping-the-data-with-r" id="toc-scraping-the-data-with-r" class="nav-link" data-scroll-target="#scraping-the-data-with-r"><span class="header-section-number">3</span> Scraping the data with R</a>
  <ul class="collapse">
  <li><a href="#prepare-the-environment" id="toc-prepare-the-environment" class="nav-link" data-scroll-target="#prepare-the-environment"><span class="header-section-number">3.1</span> Prepare the environment</a></li>
  <li><a href="#scraping" id="toc-scraping" class="nav-link" data-scroll-target="#scraping"><span class="header-section-number">3.2</span> Scraping</a>
  <ul class="collapse">
  <li><a href="#list-the-urls-of-the-chinese-classic-books" id="toc-list-the-urls-of-the-chinese-classic-books" class="nav-link" data-scroll-target="#list-the-urls-of-the-chinese-classic-books">List the URLs of the Chinese classic books</a></li>
  <li><a href="#retrieve-the-urls-of-the-chapters-of-a-book" id="toc-retrieve-the-urls-of-the-chapters-of-a-book" class="nav-link" data-scroll-target="#retrieve-the-urls-of-the-chapters-of-a-book">Retrieve the URLs of the chapters of a book</a></li>
  <li><a href="#scrape-the-content-of-the-chapters" id="toc-scrape-the-content-of-the-chapters" class="nav-link" data-scroll-target="#scrape-the-content-of-the-chapters">Scrape the content of the chapters</a></li>
  </ul></li>
  <li><a href="#save-the-data" id="toc-save-the-data" class="nav-link" data-scroll-target="#save-the-data"><span class="header-section-number">3.3</span> Save the data</a></li>
  </ul></li>
  <li><a href="#markdown-document-pdf-output-file-rdata-and-excel-files-of-the-scraped-data" id="toc-markdown-document-pdf-output-file-rdata-and-excel-files-of-the-scraped-data" class="nav-link" data-scroll-target="#markdown-document-pdf-output-file-rdata-and-excel-files-of-the-scraped-data"><span class="header-section-number">4</span> Markdown document, PDF output file, RData and Excel files of the scraped data</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block">Weeks 8 &amp; 9: Building a corpus from literature sources</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<style>
hr.rounded {
  border-top: 1px solid #E5E4E2;
  border-radius: 5px;
}
</style>
<p><br></p>
<div class="callout callout-style-default callout-warning no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Objectives
</div>
</div>
<div class="callout-body-container callout-body">
<p>These two weeks, you will learn how to use R to build a corpus from online literature sources.</p>
<p>The content is very similar to Weeks 6 and 7. It is just adapted to another website. You are invited to do the comparisons for yourself!</p>
</div>
</div>
<section id="building-your-own-corpus-again-what-you-need-to-know" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Building your own corpus again: What you need to know</h1>
<p>These two weeks are dedicated to building your corpus covering books from the classic Chinese literature. You may have one question in mind: Why not just using the codes written in Weeks 6 and 7 one more time? Or maybe you are asking yourself whether it is better to redo everuthing from the start. The actual answer is somewhere in between.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Think about it
</div>
</div>
<div class="callout-body-container callout-body">
<p>Please try to recall what we learned in Weeks 6 and 7, and you will easily understand why the answer is somewhere in between:</p>
<ul>
<li><p>We wrote the code based on the structure of a specific webpage. But the structure of other websites is very likely to be different. Therefore, it is <u><strong>impossible</strong></u> to use the exact same code!</p></li>
<li><p>But we can use the same mindset and protocol. It is therefore <u><strong>possible</strong></u> to use the same code, but to adapt the parameters to the new website. we want to use.</p></li>
</ul>
</div>
</div>
<p>For these two weeks, we are going to use the website called “millionbook” (or in Chinese, 龍勝世紀), where we can find quite a number of books that are HTML-encoded. The website can be accessed here: <a href="https://millionbook.net/" class="uri">https://millionbook.net/</a>.</p>
</section>
<section id="document-your-own-manual-steps" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Document your own manual steps</h1>
<section id="what-is-the-task" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="what-is-the-task"><span class="header-section-number">2.1</span> What is the task</h2>
<p>Again, you need to be very clear about what you want to do, and the best way is to start with manually annotating what you want to do.</p>
<p>So here is your task:</p>
<ol type="1">
<li><p>Go to the website, and search for the section related to classic Chinese literature. Then act as if you wanted to copy and paste the content of one book, of a second bool, etc.</p></li>
<li><p>Describe each step you take to get to the chapters/sections of a book, and document the changes that happen regarding <strong>the address of the website</strong>.</p></li>
</ol>
</section>
<section id="documentation-of-the-manual-steps" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="documentation-of-the-manual-steps"><span class="header-section-number">2.2</span> Documentation of the manual steps</h2>
<section id="accessing-the-individual-books" class="level3">
<h3 class="anchored" data-anchor-id="accessing-the-individual-books">Accessing the individual books</h3>
<p>First, you went to the website by clicking on the link, and you looked for the relevant section. Then, you selected one book, and you picked the first chapter. You copied and pasted in a Word or Excel document. Third, you repeated this action with the other chapters, and once you completed the first book, you continued with the second one, third one, etc.</p>
<p>This procedure looks like this:</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="DiagrammeR html-widget html-fill-item" id="htmlwidget-13e7be49fd7cdf3aee6e" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-13e7be49fd7cdf3aee6e">{"x":{"diagram":"\n    graph TD\n        A[<i>millionbook<\/i> website] -- Select classic Chinese books --> B{Filtered books};\n        B --> C[Click on the title of one book];\n        C --> D[Click on one chapter];\n        D --> E[Copy and paste the title of the chapter, and its content into Excel, Word, etc.]\n    "},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Now you can try one more time and pay more attention to <strong>the web address</strong>, and track the changes that occur, as you did in Weeks 6 and 7. You will remark that while the changes make sense (use of the first letter of the romanization of the name of the authors), but it is not an easy task to predict these by yourself.</p>
<p>We have to use an alternative method. If you recall the steps we went through in the past two weeks, we know that <strong><em>the web address of the individual books and chapters</em></strong> must be somewhere on the website… but where? Again, this is the moment when it is important to <strong>understand the structure of the website</strong>.</p>
</section>
</section>
<section id="more-about-the-structure-of-the-website" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="more-about-the-structure-of-the-website"><span class="header-section-number">2.3</span> More about the structure of the website</h2>
<p>We are clear about the task now: We want to get the data from classic Chinese books. We could start with the original link of the website, and try to find the link to the webpage by parsing the pages one by one. But sometimes, it is just easier to go manually, so we will directly start from the page listing all the classic Chinese books: <a href="https://millionbook.net/gd/gdxs.html" class="uri">https://millionbook.net/gd/gdxs.html</a>.</p>
<p>The real game begins: How to find the links to the webpages of the individual books? We know from our manual check in the previous section that we cannot really guess the links. So we have no choice but to look at the structure of the website.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Do you remember how to access the structure of the website?
</div>
</div>
<div class="callout-body-container callout-body">
<p>This is the same step as in Weeks 6 and 7 described <a href="https://aymeric-collart.github.io/CHU0387/Weeks6_7.html#how-to-access-the-structure-of-the-website">here</a>.</p>
</div>
</div>
<p>Once you accessed the structure of the webpage, it is time to play hide and seek and look for one book, let’s sat the first one: 紅樓夢 (<em>Dream of the Red Chamber</em>). You will find these lines:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&lt;</span>TR<span class="sc">&gt;</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="er">&lt;</span>TD WIDTH<span class="ot">=</span><span class="st">"33%"</span> class<span class="ot">=</span><span class="st">"tt1"</span><span class="sc">&gt;</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    <span class="er">&lt;</span>A HREF<span class="ot">=</span><span class="st">"c/caoxueqing/hlm/index.html"</span> <span class="sc">&gt;</span>紅樓夢<span class="sc">&lt;</span><span class="er">/</span>A<span class="sc">&gt;</span>(曹雪芹)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="sc">&lt;</span><span class="er">/</span>TD<span class="sc">&gt;</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="er">&lt;</span>TD WIDTH<span class="ot">=</span><span class="st">"33%"</span> class<span class="ot">=</span><span class="st">"tt1"</span><span class="sc">&gt;</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    <span class="er">&lt;</span>B<span class="sc">&gt;</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>      <span class="er">&lt;</span>A HREF<span class="ot">=</span><span class="st">"l/luoguanzhong/index.html"</span> <span class="sc">&gt;</span>羅貫中文集<span class="sc">&lt;</span><span class="er">/</span>A<span class="sc">&gt;</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    <span class="er">&lt;/</span>B<span class="sc">&gt;</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  <span class="er">&lt;/</span>TD<span class="sc">&gt;</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  <span class="er">&lt;</span>TD WIDTH<span class="ot">=</span><span class="st">"33%"</span> class<span class="ot">=</span><span class="st">"tt1"</span><span class="sc">&gt;</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="er">&lt;</span>A HREF<span class="ot">=</span><span class="st">"s/shinaian/shz/index.html"</span> <span class="sc">&gt;</span>水滸傳<span class="sc">&lt;</span><span class="er">/</span>A<span class="sc">&gt;</span>(施耐庵)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  <span class="sc">&lt;</span><span class="er">/</span>TD<span class="sc">&gt;</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="er">&lt;/</span>TR<span class="sc">&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Pay attention
</div>
</div>
<div class="callout-body-container callout-body">
<p>Each website has its own organization, and here you have an example:</p>
<ul>
<li><p>Some HTML codes are written in capital letters, but this is not relevant to scrape the data</p></li>
<li><p>The links to the individual books are shorten, which means that we will have to recreate them</p></li>
<li><p>The structure is not always consistent, so we need to keep this in mind during the scraping process</p></li>
</ul>
</div>
</div>
<p>The most challenging part here is the fact the the links are shorten. If you click on them, you actually obtain something like that:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>https<span class="sc">:</span><span class="er">//</span>millionbook.net<span class="sc">/</span>gd<span class="sc">/</span>c<span class="sc">/</span>caoxueqing<span class="sc">/</span>hlm<span class="sc">/</span>index.html</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This will be an additional step to add in the code.</p>
<section id="accessing-the-individual-chapters" class="level3">
<h3 class="anchored" data-anchor-id="accessing-the-individual-chapters">Accessing the individual chapters</h3>
<p>Let’s access the first book with the link above. The website looks like that:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/clipboard-2371039284.png" class="img-fluid figure-img"></p>
<figcaption>We have a table with the chapter number on the left grey part, and on the right the title of the chapter with the hyperlink. The structure looks like this:</figcaption>
</figure>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&lt;</span>tr<span class="sc">&gt;</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="er">&lt;</span>td<span class="sc">&gt;</span>第 一 回<span class="sc">&amp;</span>nbsp;<span class="sc">&lt;</span><span class="er">/</span>td<span class="sc">&gt;</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="er">&lt;</span>td<span class="sc">&gt;</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="er">&lt;</span>a href<span class="ot">=</span><span class="st">"001.htm"</span> <span class="sc">&gt;</span>甄士隱夢幻識通靈<span class="sc">&amp;</span>nbsp;<span class="sc">&lt;</span><span class="er">/</span>a<span class="sc">&gt;</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="er">&lt;</span>br<span class="sc">&gt;</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="er">&lt;</span>a href<span class="ot">=</span><span class="st">"001.htm"</span> <span class="sc">&gt;</span>賈雨村風塵怀閨秀<span class="sc">&amp;</span>nbsp;<span class="sc">&lt;</span><span class="er">/</span>a<span class="sc">&gt;</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="er">&lt;/</span>td<span class="sc">&gt;</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  <span class="er">&lt;</span>td<span class="sc">&gt;</span>第 二 回<span class="sc">&amp;</span>nbsp;<span class="sc">&lt;</span><span class="er">/</span>td<span class="sc">&gt;</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  <span class="er">&lt;</span>td<span class="sc">&gt;</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    <span class="er">&lt;</span>a href<span class="ot">=</span><span class="st">"002.htm"</span> <span class="sc">&gt;</span>賈夫人仙逝揚州城<span class="sc">&amp;</span>nbsp;<span class="sc">&lt;</span><span class="er">/</span>a<span class="sc">&gt;</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    <span class="er">&lt;</span>br<span class="sc">&gt;</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    <span class="er">&lt;</span>a href<span class="ot">=</span><span class="st">"002.htm"</span> <span class="sc">&gt;</span>冷子興演說榮國府<span class="sc">&lt;</span><span class="er">/</span>a<span class="sc">&gt;</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>  <span class="er">&lt;/</span>td<span class="sc">&gt;</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="er">&lt;/</span>tr<span class="sc">&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The &lt;tr&gt; and &lt;td&gt; elements are here to create the table. &lt;br&gt; means “go to the next line”, and this is why the titles of the chapters are on two lines on the website.</p>
<p>But you will remark two things when observing the links:</p>
<ol type="1">
<li><p>Again, they are shorten. If you click on them, you actually have something like that: <a href="https://millionbook.net/gd/c/caoxueqing/hlm/001.htm" class="uri">https://millionbook.net/gd/c/caoxueqing/hlm/001.htm</a>. So we know that this is another link we will have to reconstruct. The good news is that this is very predictable.</p></li>
<li><p>The same links appear two times. This will require extra work when writing the code, but we already encountered the same problem in the past two weeks. So nothing impossible to do!</p></li>
</ol>
</section>
<section id="accessing-the-content-of-the-chapter" class="level3">
<h3 class="anchored" data-anchor-id="accessing-the-content-of-the-chapter">Accessing the content of the chapter</h3>
<p>Let’s click on the link to Chapter 1, and let’s have a look at the webpage:</p>
<p><img src="images/clipboard-1447127949.png" class="img-fluid"></p>
<p>We have here:</p>
<ol type="1">
<li><p>The title of the chapter in red</p></li>
<li><p>The text of the chapter in black</p></li>
<li><p>Three links leading to the previous chapter, the next chapter and the table of contents in blue</p></li>
</ol>
<p>Again, let’s look at the structure of the website:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&lt;</span>TD class<span class="ot">=</span><span class="st">"tt2"</span> bgcolor<span class="ot">=</span><span class="st">"#F1F1F3"</span> width<span class="ot">=</span><span class="st">"84%"</span><span class="sc">&gt;</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="er">&lt;</span>center<span class="sc">&gt;</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    <span class="er">&lt;</span>FONT style<span class="ot">=</span><span class="st">"FONT-SIZE: 12pt"</span> COLOR<span class="ot">=</span><span class="st">"#FF5555"</span><span class="sc">&gt;</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>      <span class="er">&lt;</span>B<span class="sc">&gt;</span>第一回　甄士隱夢幻識通靈　賈雨村風塵怀閨秀</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>      <span class="sc">&lt;</span><span class="er">/</span>B<span class="sc">&gt;</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="er">&lt;/</span>center<span class="sc">&gt;</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    <span class="er">&lt;/</span>FONT<span class="sc">&gt;</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="er">&lt;</span>hr color<span class="ot">=</span><span class="st">"#EE9B73"</span> size<span class="ot">=</span><span class="st">"1"</span> width<span class="ot">=</span><span class="st">"94%"</span><span class="sc">&gt;</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="er">&lt;</span>BR<span class="sc">&gt;</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>　　此開卷第一回也．作者自云：因曾歷過一番夢幻之后，故將真事隱去，而借<span class="st">"通靈"</span>之說，撰此《石頭記》一書也．故曰<span class="st">"甄士隱"</span>云云．但書中所記何事何人？自又云：“今風塵碌碌，一事無成，忽念及當日所有之女子，一一細考較去，覺其行止見識，皆出于我之上．何我堂堂須眉，誠不若彼裙釵哉？實愧則有余，悔又無益之大無可如何之日也！當此，則自欲將已往所賴天恩祖德，錦衣紈褲之時，飫甘饜肥之日，背父兄教育之恩，負師友規談之德，以至今日一技無成，半生潦倒之罪，編述一集，以告天下人：我之罪固不免，然閨閣中本自歷歷有人，万不可因我之不肖，自護己短，一并使其泯滅也．雖今日之茅椽蓬牖，瓦灶繩床，其晨夕風露，階柳庭花，亦未有妨我之襟怀筆墨者．雖我未學，下筆無文，又何妨用假語村言，敷演出一段故事來，亦可使閨閣昭傳，复可悅世之目，破人愁悶，不亦宜乎？<span class="st">"故曰"</span>賈雨村<span class="st">"云云．</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;BR&gt;</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;BR&gt;</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="st">　　此回中凡用“夢”用“幻”等字，是提醒閱者眼目，亦是此書立意本旨．</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;BR&gt;</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;BR&gt;</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="st">　　列位看官：你道此書從何而來？說起根由雖近荒唐，細按則深有趣味．待在下將此來歷注明，方使閱者了然不惑．</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;/TD&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>There are many things to unpack here:</p>
<ul>
<li><p>You will remark that the text as within a &lt;td&gt;&lt;/td&gt; element, and its “class” is “tt2”</p></li>
<li><p>Within this element, you have:</p>
<ul>
<li><p>&lt;center&gt; and &lt;font&gt; elements (not very well organized), and these correspond to the title in red</p></li>
<li><p>an &lt;hr&gt; element, which correspond to the orange line between the title and the main text</p></li>
<li><p>the &lt;br&gt; element one more time</p></li>
<li><p>and finally the main text, without specific class</p></li>
</ul></li>
</ul>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Think about it
</div>
</div>
<div class="callout-body-container callout-body">
<p>The text is therefore directly within the &lt;td&gt; element called “tt2”. So this is the only way to access the text… but the title is also within this element!</p>
<p>This means that we have no choice but scraping the title of the chapter as well. This is important to note such details as we will have to handle them when preprocessing the data.</p>
</div>
</div>
</section>
</section>
</section>
<section id="scraping-the-data-with-r" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Scraping the data with R</h1>
<p>In the previous sections, we clarified how to access the texts we are interested in, and we documented the challenges we will encounter. Now we are ready to let R do the job for us!</p>
<p>First, you can download the script <a href="https://github.com/aymeric-collart/CHU0387/blob/main/assets/files/_Internal/ChineseClassicLiterature_Scrape.Rmd" target="_blank">here</a>, and follow the steps below to understand how it works.</p>
<p>[Disclaimer: The explanation of the R codes is made by <i>Gemini</i> as an illustration of the use of such tools to decode a script.]</p>
<p>This R Markdown script is a web scraper designed to download the full text of Chinese classic literature from the website <code>millionbook.net</code>. It first finds all the book index pages, then finds all the chapter pages for each book, and finally scrapes the text from every chapter, saving the combined text into a single dataset.</p>
<section id="prepare-the-environment" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="prepare-the-environment"><span class="header-section-number">3.1</span> Prepare the environment</h2>
<p>This initial chunk loads all the necessary R packages (libraries) required for the script to run.</p>
<ul>
<li><p><strong>library(rvest):</strong> The main package for web scraping. It’s used to read HTML web pages and extract information from them.</p></li>
<li><p><strong>library(dplyr):</strong> A powerful data manipulation package. It’s used here for its %&gt;% (pipe) operator, which makes the code more readable by chaining commands together, and for functions like subset.</p></li>
<li><p><strong>library(xml2):</strong> A package that rvest depends on to parse and handle the underlying HTML and XML data.</p></li>
<li><p><strong>library(openxlsx):</strong> Used in the final step to save the scraped data as a .xlsx Excel file.</p></li>
<li><p><strong>library(stringr):</strong> A package for working with text (strings). It’s used here for functions like str_detect (to check if a URL contains “.jpg” or “index.html”) and gsub (to modify URLs).</p></li>
</ul>
<p>Here is an explanation of the R code from your file, broken down by each section.</p>
</section>
<section id="scraping" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="scraping"><span class="header-section-number">3.2</span> Scraping</h2>
<p>This section is the core of the script, performing the actual data extraction from the website.</p>
<section id="list-the-urls-of-the-chinese-classic-books" class="level3">
<h3 class="anchored" data-anchor-id="list-the-urls-of-the-chinese-classic-books">List the URLs of the Chinese classic books</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>PageUrl <span class="ot">&lt;-</span> <span class="st">"https://millionbook.net/gd/gdxs.html"</span> </span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>PageClassChinLit <span class="ot">&lt;-</span> <span class="fu">read_html</span>(PageUrl)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>ListBooks <span class="ot">&lt;-</span> PageClassChinLit <span class="sc">%&gt;%</span> </span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_nodes</span>(<span class="st">".tt1"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_text</span>()</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>ListBooks <span class="ot">&lt;-</span> ListBooks[<span class="sc">-</span><span class="fu">c</span>(<span class="dv">90</span>)] <span class="co"># Remove blank one</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>ListURL <span class="ot">&lt;-</span> PageClassChinLit <span class="sc">%&gt;%</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_nodes</span>(<span class="st">".tt1"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_nodes</span>(<span class="st">"a"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_attr</span>(<span class="st">"href"</span>)</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>ListBooks <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(ListBooks)</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>ListBooks<span class="sc">$</span>ListURL <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"https://millionbook.net/gd/"</span>, ListURL)</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="do">## Check if books finish with "index.html"</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>ListBooks<span class="sc">$</span>has_index <span class="ot">&lt;-</span> <span class="fu">str_detect</span>(ListBooks<span class="sc">$</span>ListURL, <span class="st">"index.html"</span>)</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a><span class="do">## Remove books without index (other scraping process)</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>ListBooks<span class="sc">$</span>has_index <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(ListBooks<span class="sc">$</span>has_index)</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>ListBooks <span class="ot">&lt;-</span> <span class="fu">droplevels</span>(<span class="fu">subset</span>(ListBooks, has_index <span class="sc">==</span> <span class="cn">TRUE</span>))</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(ListBooks) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This part gets the list of all available books from the main classical literature index page.</p>
<ol type="1">
<li><p><code>PageUrl &lt;- "..."</code>: Sets the target URL to the main index page.</p></li>
<li><p><code>read_html(PageUrl)</code>: Downloads the HTML content of that page.</p></li>
<li><p><code>html_nodes(".tt1")</code>: Selects all HTML elements that have the CSS class “tt1”. Based on the code, these elements contain the book titles.</p></li>
<li><p><code>html_text()</code>: Extracts the plain text (the titles) from those elements.</p></li>
<li><p><code>ListBooks[-c(90)]</code>: Removes the 90th item, which the author noted was a blank entry.</p></li>
<li><p><code>html_nodes("a") %&gt;% html_attr("href")</code>: This finds the <code>&lt;a&gt;</code> (link) tags <em>within</em> the “.tt1” elements and extracts their <code>href</code> attribute (the actual URL, e.g., “book_name/index.html”).</p></li>
<li><p><code>ListBooks &lt;- as.data.frame(ListBooks)</code>: Converts the list of titles into a data frame.</p></li>
<li><p><code>paste0(...)</code>: Creates full, absolute URLs by combining the base URL (<code>https://millionbook.net/gd/</code>) with the relative URLs (e.g., “book_name/index.html”) extracted earlier.</p></li>
<li><p><code>str_detect(...)</code> &amp; <code>subset(...)</code>: This is a data cleaning step. The code checks which URLs end in “index.html” (which are assumed to be book-level index pages) and removes any that don’t, ensuring the list only contains valid books to scrape.</p></li>
</ol>
</section>
<section id="retrieve-the-urls-of-the-chapters-of-a-book" class="level3">
<h3 class="anchored" data-anchor-id="retrieve-the-urls-of-the-chapters-of-a-book">Retrieve the URLs of the chapters of a book</h3>
<p>This section digs one level deeper. It goes into each <em>book’s</em> index page to find the URLs for all of its <em>chapters</em>.</p>
<section id="one-page-to-test" class="level4">
<h4 class="anchored" data-anchor-id="one-page-to-test">One page to test</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>IndBook <span class="ot">&lt;-</span> <span class="fu">read_html</span>(ListBooks<span class="sc">$</span>ListURL[<span class="dv">81</span>])</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>ChapterURL <span class="ot">&lt;-</span> IndBook <span class="sc">%&gt;%</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_nodes</span>(<span class="st">"td"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_nodes</span>(<span class="st">"a"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_attr</span>(<span class="st">"href"</span>)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>ChapterURL <span class="ot">&lt;-</span> ChapterURL[<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>)]</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(ChapterURL)</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>ChapterURL <span class="ot">&lt;-</span> <span class="fu">unique</span>(ChapterURL)</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(ChapterURL)</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="do">## Reconstruct the full URL</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>TempBookURL <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"index.html"</span>, <span class="st">""</span>, ListBooks<span class="sc">$</span>ListURL[<span class="dv">81</span>])</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>FullChapterURL <span class="ot">&lt;-</span> <span class="fu">paste0</span>(TempBookURL, ChapterURL)</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(FullChapterURL)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This chunk is a test run on a single book (<code>ListBooks$ListURL[81]</code>) to make sure the logic works before applying it to all books.</p>
<ol type="1">
<li><p><code>read_html(...)</code>: Downloads the HTML for one book’s index page.</p></li>
<li><p><code>html_nodes("td") %&gt;% html_nodes("a") %&gt;% html_attr("href")</code>: Finds all links (<code>&lt;a&gt;</code>) that are inside table cells (<code>&lt;td&gt;</code>) and gets their URLs. This is how the chapter list is structured on that page.</p></li>
<li><p><code>ChapterURL &lt;- ChapterURL[-c(1, 2, 3)]</code>: Removes the first three links, which are likely navigation links (e.g., “Home,” “Back”) and not chapters.</p></li>
<li><p><code>unique(ChapterURL)</code>: Removes any duplicate chapter links.</p></li>
<li><p><code>gsub(...)</code> &amp; <code>paste0(...)</code>: This reconstructs the full chapter URLs. It takes the book’s URL (e.g., <code>.../book_name/index.html</code>), removes the “index.html” part to get a base directory, and then appends the specific chapter file (e.g., <code>001.html</code>) to it.</p></li>
</ol>
</section>
<section id="find-the-urls-of-the-chapters-from-all-the-books" class="level4">
<h4 class="anchored" data-anchor-id="find-the-urls-of-the-chapters-from-all-the-books">Find the URLs of the chapters from all the books</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>URL_BookChapters_total <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">matrix</span>(<span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">nrow =</span> <span class="dv">0</span>))</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(ListBooks<span class="sc">$</span>ListURL)){</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  IndBook <span class="ot">&lt;-</span> <span class="fu">read_html</span>(ListBooks<span class="sc">$</span>ListURL[i])</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  ChapterURL <span class="ot">&lt;-</span> IndBook <span class="sc">%&gt;%</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">html_nodes</span>(<span class="st">"td"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">html_nodes</span>(<span class="st">"a"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">html_attr</span>(<span class="st">"href"</span>)</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  ChapterURL <span class="ot">&lt;-</span> ChapterURL[<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>)]</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>  ChapterURL <span class="ot">&lt;-</span> <span class="fu">unique</span>(ChapterURL)</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>  TempBookURL <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"index.html"</span>, <span class="st">""</span>, ListBooks<span class="sc">$</span>ListURL[i])</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>  FullChapterURL <span class="ot">&lt;-</span> <span class="fu">paste0</span>(TempBookURL, ChapterURL)</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>  URL_BookChapters <span class="ot">&lt;-</span> (<span class="fu">data.frame</span>(<span class="at">ChapterURL =</span> FullChapterURL,</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>                       <span class="at">Book =</span> ListBooks<span class="sc">$</span>ListBooks[i]))</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>  URL_BookChapters_total <span class="ot">&lt;-</span> <span class="fu">rbind</span>(URL_BookChapters_total, URL_BookChapters)</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a><span class="do">## Remove links to images (.jpg)</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a><span class="do">## Check if books finish with "index.html"</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>URL_BookChapters_total<span class="sc">$</span>image <span class="ot">&lt;-</span> <span class="fu">str_detect</span>(URL_BookChapters_total<span class="sc">$</span>ChapterURL, <span class="st">".jpg"</span>)</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>URL_BookChapters_total<span class="sc">$</span>image <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(URL_BookChapters_total<span class="sc">$</span>image)</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>URL_BookChapters_total <span class="ot">&lt;-</span> <span class="fu">droplevels</span>(<span class="fu">subset</span>(URL_BookChapters_total, image <span class="sc">!=</span> <span class="cn">TRUE</span>))</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(URL_BookChapters_total) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This part applies the logic from the test (2.2.1) to <em>every book</em> found in section 2.1.</p>
<ol type="1">
<li><p><code>URL_BookChapters_total &lt;- data.frame(...)</code>: Creates an empty data frame to store all the chapter URLs from all books.</p></li>
<li><p><code>for (i in 1:length(ListBooks$ListURL))</code>: A <strong>loop</strong> that iterates through each book URL.</p></li>
<li><p>Inside the loop, it repeats the exact same logic from 2.2.1 (read page, find links, clean, create full URLs).</p></li>
<li><p><code>URL_BookChapters &lt;- (data.frame(...))</code>: Creates a small data frame for the current book’s chapters, helpfully including the book’s title.</p></li>
<li><p><code>rbind(...)</code>: Appends this small data frame to the main <code>URL_BookChapters_total</code> data frame.</p></li>
<li><p><strong>Post-loop Cleaning</strong>: After the loop finishes, <code>str_detect</code> is used to find and remove any links that mistakenly point to <code>.jpg</code> image files instead of text chapters. The comments note that inconsistent site structure for a few books caused issues, which this cleaning step helps fix.</p></li>
</ol>
</section>
</section>
<section id="scrape-the-content-of-the-chapters" class="level3">
<h3 class="anchored" data-anchor-id="scrape-the-content-of-the-chapters">Scrape the content of the chapters</h3>
<p>This is the final scraping step, where the script visits every single chapter URL and downloads the actual text.</p>
<section id="test-with-one-page" class="level4">
<h4 class="anchored" data-anchor-id="test-with-one-page">Test with one page</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>Chapter <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>j <span class="ot">=</span> <span class="dv">3672</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>OneChapter <span class="ot">&lt;-</span> <span class="fu">read_html</span>(URL_BookChapters_total<span class="sc">$</span>ChapterURL[j])</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>ChapterContent <span class="ot">&lt;-</span> OneChapter <span class="sc">%&gt;%</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_nodes</span>(<span class="st">".tt2"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_text</span>()</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>ChapterTitle <span class="ot">&lt;-</span> <span class="fu">sub</span>(<span class="st">"</span><span class="sc">\r</span><span class="st">.*"</span>, <span class="st">""</span>, ChapterContent)</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>Chapter <span class="ot">&lt;-</span> (<span class="fu">data.frame</span>(<span class="at">Book =</span> URL_BookChapters_total<span class="sc">$</span>Book[j],</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>                       <span class="at">Title =</span> ChapterTitle,</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>                       <span class="at">Content =</span> ChapterContent,</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>                       <span class="at">URL =</span> URL_BookChapters_total<span class="sc">$</span>ChapterURL[j]))</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(Chapter)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Again, this is a test on a single chapter (<code>j = 3672</code>) to finalize the logic.</p>
<ol type="1">
<li><p><code>read_html(...)</code>: Downloads the HTML for one chapter page.</p></li>
<li><p><code>html_nodes(".tt2") %&gt;% html_text()</code>: Selects the HTML element with the class “tt2” (where the main content is stored) and extracts all the text from it.</p></li>
<li><p><code>sub("\r.*", "", ChapterContent)</code>: A clever trick to get the title. It assumes the title is the very first line of the text. This command finds the first carriage return (<code>\r</code>, a line break) and removes <em>everything</em> after it, leaving just the first line.</p></li>
<li><p><code>data.frame(...)</code>: Organizes the scraped data (Book, Title, Content, URL) into a data frame.</p></li>
</ol>
</section>
<section id="scrape-all-the-chapters-for-all-book" class="level4">
<h4 class="anchored" data-anchor-id="scrape-all-the-chapters-for-all-book"><strong>Scrape all the chapters for all book</strong></h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>Book_total <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(URL_BookChapters_total<span class="sc">$</span>ChapterURL)){</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tryCatch</span>({</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    OneChapter <span class="ot">&lt;-</span> <span class="fu">read_html</span>(URL_BookChapters_total<span class="sc">$</span>ChapterURL[j])</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    ChapterContent <span class="ot">&lt;-</span> OneChapter <span class="sc">%&gt;%</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">html_nodes</span>(<span class="st">".tt2"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">html_text</span>()</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    ChapterTitle <span class="ot">&lt;-</span> <span class="fu">sub</span>(<span class="st">"</span><span class="sc">\r</span><span class="st">.*"</span>, <span class="st">""</span>, ChapterContent)</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>    Chapter <span class="ot">&lt;-</span> (<span class="fu">data.frame</span>(<span class="at">Book =</span> URL_BookChapters_total<span class="sc">$</span>Book[j],</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>                           <span class="at">Title =</span> ChapterTitle,</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>                           <span class="at">Content =</span> ChapterContent,</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>                           <span class="at">URL =</span> URL_BookChapters_total<span class="sc">$</span>ChapterURL[j]))</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>    Book_total <span class="ot">&lt;-</span> <span class="fu">rbind</span>(Book_total, Chapter)</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Update the progress </span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>    percentage_completed <span class="ot">&lt;-</span> <span class="fu">round</span>(j<span class="sc">/</span><span class="fu">length</span>(URL_BookChapters_total<span class="sc">$</span>ChapterURL) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">2</span>)</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">c</span>(<span class="st">"Process"</span>, j, <span class="st">"out of"</span>, <span class="fu">length</span>(URL_BookChapters_total<span class="sc">$</span>ChapterURL), <span class="st">"percentage completed:"</span>, percentage_completed, <span class="st">"%"</span>, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>))</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>  }, <span class="at">error=</span><span class="cf">function</span>(e){<span class="fu">cat</span>(<span class="st">"ERROR :"</span>,<span class="fu">conditionMessage</span>(e), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)})</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(Book_total)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This loop executes the final scraping.</p>
<ol type="1">
<li><p><code>Book_total &lt;- data.frame()</code>: Creates a new empty data frame to store the final content.</p></li>
<li><p><code>for (j in 1:length(URL_BookChapters_total$ChapterURL))</code>: A <strong>loop</strong> that iterates through <em>every single chapter URL</em> collected in section 2.2.2.</p></li>
<li><p><code>tryCatch({...}, error=...)</code>: This is a very important safety feature. It “tries” to run the scraping code inside <code>{...}</code>. If any error occurs (e.g., a broken link, a network timeout), the <code>error=...</code> function will catch it, print an error message, and <em>continue to the next iteration of the loop</em>. Without this, the entire script would crash on a single bad link.</p></li>
<li><p>Inside the <code>tryCatch</code>, it repeats the logic from 2.3.1 (read page, get text, extract title).</p></li>
<li><p><code>rbind(...)</code>: Appends the new chapter’s data to the <code>Book_total</code> data frame.</p></li>
<li><p><code>cat(...)</code>: Prints a progress message to the console so the user can see how far along the script is.</p></li>
</ol>
</section>
</section>
</section>
<section id="save-the-data" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="save-the-data"><span class="header-section-number">3.3</span> Save the data</h2>
<p>After the main loop has finished collecting all the text, this final section saves the complete dataset.</p>
<ul>
<li><p><strong>Save as an Excel file</strong>: <code>write.xlsx(Book_total, ...)</code> saves the entire <code>Book_total</code> data frame into an Excel file named “ClassicChineseLiterature_CorpusCourse.xlsx”.</p></li>
<li><p><strong>Save as an RData file</strong>: <code>save(Book_total, file = ...)</code> saves the data frame in R’s native <code>.Rdata</code> format. This format is much faster to load back into R for future analysis.</p></li>
</ul>
</section>
</section>
<section id="markdown-document-pdf-output-file-rdata-and-excel-files-of-the-scraped-data" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Markdown document, PDF output file, RData and Excel files of the scraped data</h1>
<p>You can find the pre-filled Markdown document of this section <a href="https://github.com/aymeric-collart/CHU0387/blob/main/assets/files/_Internal/ChineseClassicLiterature_Scrape.Rmd" target="_blank">here</a>. <a href="https://github.com/aymeric-collart/CHU0387/blob/main/assets/files/_Internal/ChineseClassicLiterature_Scrape.pdf" target="_blank">Here</a> is the PDF output of the same document.</p>
<p>The RData output file can be downloaded <a href="https://github.com/aymeric-collart/CHU0387/blob/main/assets/files/_Internal/ClassicChineseLiterature_CorpusCourse.Rdata" target="_blank">here</a>. The Excel file corresponding to this dataset is <a href="https://github.com/aymeric-collart/CHU0387/blob/main/assets/files/_Internal/ClassicChineseLiterature_CorpusCourse.xlsx" target="_blank">here</a>.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Copyright 2025, Aymeric Collart</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
    <a class="nav-link" href="https://bsky.app/profile/aymericcollart.bsky.social">
<p><iconify-icon role="img" inline="" icon="fa6-brands:bluesky" aria-label="Icon bluesky from fa6-brands Iconify.design set." title="Icon bluesky from fa6-brands Iconify.design set."></iconify-icon></p>
</a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/aymeric-collart">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




</body></html>